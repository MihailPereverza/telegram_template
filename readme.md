# –®–∞–±–ª–æ–Ω –¥–ª—è —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–∞ (–º–∞–≥–∞–∑–∏–Ω–∞)


<p><img src="https://badgen.net/badge/python/3.10+/blue" />
<img src="https://badgen.net/badge/aiogram/3.0.0b5/orange" />
<img src="https://badgen.net/badge/glQiwiApi/2.12/green" />
<img src="https://badgen.net/badge/cashews/4.6.0/dc60ff" />
</p>

## –ó–∞–¥–∞—á–∏ –ø–æ —Ñ–∏—á–∞–º: 
‚úÖ –¢—Ä–æ—Ç–ª–∏–Ω–≥ middleware  
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑–æ–≤—ã–π handler –º–∏–∫—Å–∏–Ω—É –¥–ª—è –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π  
‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  
‚úÖ –•–µ–Ω–¥–ª–µ—Ä –Ω–∞ /start  
‚úÖ –ü–µ—Ä–µ–µ—Ö–∞—Ç—å —Å ormar (—Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)–Ω–∞ sqlalchemy  
‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è  
‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–º–µ—Ç–∫–∏ "–±–ª–æ–∫–æ–≤—ã—Ö" —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —É–¥–∞–ª—è—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ 
—Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫  
‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞  
‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
üîÑ –ü—Ä–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π QiWi  
üî≤ –ü—Ä–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä (—á—Ç–æ–±—ã –º–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—Å—è–∫–∏—Ö)  
...  
üî≤ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∞–¥–º–∏–Ω–∞  
...  
üî≤ –ú—É–ª—å—Ç–∏–±–æ—Ç  
üî≤ –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ


## –ó–∞–¥–∞—á–∏ –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
üî≤ –¢–µ—Å—Ç—ã (–º–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ —Ç–µ–ª–µ–≥–∏?(( –ø–æ–¥–æ–∂–¥–∞—Ç—å –≤ aiogram3, –æ–±–µ—â–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è? - good)  
üî≤ CI/CD  
üî≤ –ö–∞–∫–∏–µ-—Ç–æ –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è
"—Ç–µ—Å—Ç–∏—Ä–æ–≤–æ—á–Ω—ã—Ö" –∫–æ–º–º–∏—Ç–æ–≤


## Get start

1. –§–æ—Ä–∫–Ω—É—Ç—å –ø—Ä–æ–µ–∫—Ç
2. –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±–µ
3. –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –∫–ª—é—á–∞–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ ssl:  
   3.1 –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é openssl
–ø–æ –æ—Ñ—Ñ. –≥–∞–π–¥—É –æ—Ç —Ç–µ–ª–µ–≥–∏ (https://core.telegram.org/bots/self-signed)  
   3.2 –£–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ –Ω–∏–º –≤ –ø–æ–ª—è—Ö .env `WEBHOOK_SSL_CERT`
–∏ `WEBHOOK_SSL_PRIV`
4. –ü–æ–ª—É—á–∏—Ç—å QiWi access token –Ω–∞ —Å–∞–π—Ç–µ `https://qiwi.com/api`
5. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—è –≤ .env:
    * `PG_USER` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
    * `pg_pass` - –ø–∞—Ä–æ–ª—å postgres
    * `pg_host` - —Ö–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞ postgres
    * `PG_PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ postgres
    * `PG_DB_NAME` - –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –±–∞–∑—ã postgres
    * `TG_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –æ—Ç –±–æ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ BotFather
    * `TG_BOT_WEBHOOK_HOST` - —Ö–æ—Å—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è webhook –∞–¥—Ä–µ—Å–∞ –≤ telegram
    * `TG_BOT_WEBHOOK_PORT` - –ø–æ—Ä—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è webhook –∞–¥—Ä–µ—Å–∞ –≤ telegram
    * `TG_BOT_WEBHOOK_PATH` - –±–∞–∑–æ–≤–∞—è —á–∞—Å—Ç—å –∞–¥—Ä–µ—Å–∞ –¥–ª—è webhook
    * `QIWI_PHONE` - –Ω–æ–º–µ—Ä, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω qiwi (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    * `QIWI_ACCESS_TOKEN` - —Ç–æ–∫–µ–Ω api –∞–∫–∫–∞—É–Ω—Ç–∞ qiwi (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. –í—ã–ø–æ–ª–Ω–∏—Ç—å `pip install -r requirements.txt` (–º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
—Å psycopg2: —Ä–µ—à–µ–Ω–∏–µ - psycopg2-binary –∏ aiogram: —Ä–µ—à–µ–Ω–∏–µ - –≤ pycharm —á–µ—Ä–µ–∑ 
–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–∏—Ç–∞—Ç–æ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–µ–±—É–µ–º—É—é –≤–µ—Ä—Å–∏—é)

## Running 
#### –í–∞—Ä–∏–∞–Ω—Ç 1 - —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º ip (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)  
–í—ã–ø–æ–ª–Ω–∏—Ç—å `python app/bot.py` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞  


#### –í–∞—Ä–∏–∞–Ω—Ç 2 - –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ —Å—Ç–∞—Ç. ip) 
–ü–æ–∫–∞ –¥—É–º–∞—é, –∫–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç, ngrok –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ